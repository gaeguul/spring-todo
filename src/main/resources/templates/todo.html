<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Todo</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous">
    </script>
</head>
<style>
    .modal {
        position:absolute;
        width:100%;
        height:100%;
        background:black;
        top:0;
        left:0;
        display:none;
    }
</style>
<body>
<h1>íˆ¬ë‘ë¦¬ìŠ¤íŠ¸</h1>
<form th:action="@{/todo/create}" method="post">
    <label>
        <input name="content" placeholder="ì˜¤ëŠ˜ì˜ í•  ì¼ ğŸ™‚">
    </label>
    <button type="submit">ì‘ì„±</button>
</form>
<table>
    <thead>
    <tr>
        <th>ë²ˆí˜¸</th>
        <th>í•  ì¼</th>
        <th>ìˆ˜í–‰ ì—¬ë¶€</th>
        <th>ì‚­ì œ</th>
    </thead>
    <tbody>
    <tr th:each="todo : ${todoList}">
        <td th:text="${todo.id}"></td>
        <td th:text="${todo.content}"></td>
        <td th:text="${todo.completed}"></td>
        <td>
            <button id="delete-btn" th:onClick="deleteItem([[${todo.id}]])">ì‚­ì œ</button>
        </td>
        <td>
            <button id="update-btn" th:onClick="openModal([[${todo.id}]])">ìˆ˜ì •</button>
        </td>
    </tr>
    </tbody>
</table>
<div class="modal">
    <div class="modal-content">
        <input id="update" placeholder="ìˆ˜ì •í•  ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"/>
        <button id="complete-btn" type="submit" onclick="updateTodo()">ì™„ë£Œ</button>
    </div>

</div>
<script>

    function deleteItem(id) {
        console.log(id);
        const url = "/todo/delete/"+id
        $.ajax({
                type: 'delete',
                url: url,
        }).done( function () {
                console.log("Success deletion");
                window.location.href = '/';
        }).fail( function (error) {
                alert(JSON.stringify(error));
        });
    }

    let todoId = "";

    function openModal(id) {
        todoId = id;
        $(".modal").fadeIn();
    }

    function updateTodo() {
        console.log(todoId);
        var prevContent = document.getElementById("update").value;
        var updateContent = prevContent;
        console.log(updateContent);
        const url = "/todo/update/" + todoId;

        $.ajax({
            type: 'patch',
            url: url,
            contentType:'application/json; charset=utf-8',
            data: updateContent,
        }).done(
            function() {
                alert("í•  ì¼ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.");
                window.location.href='/';
            }
        ).fail(
            function(error) {
                alert(JSON.stringify(error));
            }
        );

        $(".modal").fadeOut();
    }


</script>
</body>
</html>